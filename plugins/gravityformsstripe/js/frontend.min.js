!function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t,r){"use strict";r.r(t),r.d(t,"Headers",(function(){return m})),r.d(t,"Request",(function(){return w})),r.d(t,"Response",(function(){return S})),r.d(t,"DOMException",(function(){return j})),r.d(t,"fetch",(function(){return O}));var i="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof self&&self||void 0!==i&&i,n="URLSearchParams"in i,s="Symbol"in i&&"iterator"in Symbol,a="FileReader"in i&&"Blob"in i&&function(){try{return new Blob,!0}catch(e){return!1}}(),o="FormData"in i,d="ArrayBuffer"in i;if(d)var l=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],p=ArrayBuffer.isView||function(e){return e&&l.indexOf(Object.prototype.toString.call(e))>-1};function c(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function f(e){return"string"!=typeof e&&(e=String(e)),e}function u(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return s&&(t[Symbol.iterator]=function(){return t}),t}function m(e){this.map={},e instanceof m?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function h(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function _(e){return new Promise((function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}}))}function g(e){var t=new FileReader,r=_(t);return t.readAsArrayBuffer(e),r}function y(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(e){var t;this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"==typeof e?this._bodyText=e:a&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:o&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:n&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():d&&a&&((t=e)&&DataView.prototype.isPrototypeOf(t))?(this._bodyArrayBuffer=y(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):d&&(ArrayBuffer.prototype.isPrototypeOf(e)||p(e))?this._bodyArrayBuffer=y(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):n&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},a&&(this.blob=function(){var e=h(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=h(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(g)}),this.text=function(){var e,t,r,i=h(this);if(i)return i;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,r=_(t),t.readAsText(e),r;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),r=new Array(t.length),i=0;i<t.length;i++)r[i]=String.fromCharCode(t[i]);return r.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},o&&(this.formData=function(){return this.text().then(F)}),this.json=function(){return this.text().then(JSON.parse)},this}m.prototype.append=function(e,t){e=c(e),t=f(t);var r=this.map[e];this.map[e]=r?r+", "+t:t},m.prototype.delete=function(e){delete this.map[c(e)]},m.prototype.get=function(e){return e=c(e),this.has(e)?this.map[e]:null},m.prototype.has=function(e){return this.map.hasOwnProperty(c(e))},m.prototype.set=function(e,t){this.map[c(e)]=f(t)},m.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},m.prototype.keys=function(){var e=[];return this.forEach((function(t,r){e.push(r)})),u(e)},m.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),u(e)},m.prototype.entries=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),u(e)},s&&(m.prototype[Symbol.iterator]=m.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function w(e,t){if(!(this instanceof w))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');var r,i,n=(t=t||{}).body;if(e instanceof w){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new m(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new m(t.headers)),this.method=(r=t.method||this.method||"GET",i=r.toUpperCase(),v.indexOf(i)>-1?i:r),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(n),!("GET"!==this.method&&"HEAD"!==this.method||"no-store"!==t.cache&&"no-cache"!==t.cache)){var s=/([?&])_=[^&]*/;if(s.test(this.url))this.url=this.url.replace(s,"$1_="+(new Date).getTime());else{this.url+=(/\?/.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function F(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var r=e.split("="),i=r.shift().replace(/\+/g," "),n=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(i),decodeURIComponent(n))}})),t}function S(e,t){if(!(this instanceof S))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new m(t.headers),this.url=t.url||"",this._initBody(e)}w.prototype.clone=function(){return new w(this,{body:this._bodyInit})},b.call(w.prototype),b.call(S.prototype),S.prototype.clone=function(){return new S(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new m(this.headers),url:this.url})},S.error=function(){var e=new S(null,{status:0,statusText:""});return e.type="error",e};var T=[301,302,303,307,308];S.redirect=function(e,t){if(-1===T.indexOf(t))throw new RangeError("Invalid status code");return new S(null,{status:t,headers:{location:e}})};var j=i.DOMException;try{new j}catch(e){(j=function(e,t){this.message=e,this.name=t;var r=Error(e);this.stack=r.stack}).prototype=Object.create(Error.prototype),j.prototype.constructor=j}function O(e,t){return new Promise((function(r,n){var s=new w(e,t);if(s.signal&&s.signal.aborted)return n(new j("Aborted","AbortError"));var o=new XMLHttpRequest;function l(){o.abort()}o.onload=function(){var e,t,i={status:o.status,statusText:o.statusText,headers:(e=o.getAllResponseHeaders()||"",t=new m,e.replace(/\r?\n[\t ]+/g," ").split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var r=e.split(":"),i=r.shift().trim();if(i){var n=r.join(":").trim();t.append(i,n)}})),t)};i.url="responseURL"in o?o.responseURL:i.headers.get("X-Request-URL");var n="response"in o?o.response:o.responseText;setTimeout((function(){r(new S(n,i))}),0)},o.onerror=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},o.ontimeout=function(){setTimeout((function(){n(new TypeError("Network request failed"))}),0)},o.onabort=function(){setTimeout((function(){n(new j("Aborted","AbortError"))}),0)},o.open(s.method,function(e){try{return""===e&&i.location.href?i.location.href:e}catch(t){return e}}(s.url),!0),"include"===s.credentials?o.withCredentials=!0:"omit"===s.credentials&&(o.withCredentials=!1),"responseType"in o&&(a?o.responseType="blob":d&&s.headers.get("Content-Type")&&-1!==s.headers.get("Content-Type").indexOf("application/octet-stream")&&(o.responseType="arraybuffer")),!t||"object"!=typeof t.headers||t.headers instanceof m?s.headers.forEach((function(e,t){o.setRequestHeader(t,e)})):Object.getOwnPropertyNames(t.headers).forEach((function(e){o.setRequestHeader(e,f(t.headers[e]))})),s.signal&&(s.signal.addEventListener("abort",l),o.onreadystatechange=function(){4===o.readyState&&s.signal.removeEventListener("abort",l)}),o.send(void 0===s._bodyInit?null:s._bodyInit)}))}O.polyfill=!0,i.fetch||(i.fetch=O,i.Headers=m,i.Request=w,i.Response=S)},,function(e,t,r){r(0),e.exports=r(5)},,,function(e,t,r){"use strict";r.r(t);var i,n=async(e,t=!1,r=!1,i=!1)=>{const n={method:"POST",credentials:"same-origin",body:e};t&&(n.headers={Accept:"application/json","content-type":"application/json"});const s=new URL(gforms_stripe_frontend_strings.ajaxurl);return r&&s.searchParams.set("action",r),i&&s.searchParams.set("nonce",i),console.log(s.toString()),await fetch(s.toString(),n).then(e=>e.json())},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e};class a{constructor(e,t){if(this.GFStripeObj=t,this.apiKey=e,this.stripe=null,this.elements=null,this.card=null,this.paymentMethod=null,this.draftId=null,this.validateForm=this.validate.bind(this),this.handlelinkEmailFieldChange=this.reInitiateLinkWithEmailAddress.bind(this),this.clearErrors(),!this.initStripe()||"1"!==gforms_stripe_frontend_strings.stripe_connect_enabled)return;this.link=this.elements.create("linkAuthentication"),this.card=this.elements.create("payment"),t.activeFeed.link_email_field_id?this.mountLink():this.link=null,this.mountCard(),this.bindEvents();const r=document.querySelector("#input_"+this.GFStripeObj.formId+"_"+this.GFStripeObj.activeFeed.link_email_field_id);r&&r.value&&this.handlelinkEmailFieldChange({target:{value:r.value}})}async initStripe(){this.stripe=Stripe(this.apiKey);const e=this.GFStripeObj.activeFeed.initial_payment_information,t=this.GFStripeObj.cardStyle;return"payment_method_types"in e&&(e.payment_method_types=Object.values(e.payment_method_types)),this.elements=this.stripe.elements(s({},e,{appearance:t})),!0}mountCard(){this.card.mount("#"+this.GFStripeObj.GFCCField.attr("id"))}mountLink(){if(null!==this.link){if(document.querySelectorAll(".stripe-payment-link").length<=0){const e=document.createElement("div");e.setAttribute("id","stripe-payment-link"),e.classList.add("StripeElement--link"),this.GFStripeObj.GFCCField.before(jQuery(e))}this.link.mount("#stripe-payment-link")}}async bindEvents(){this.card&&this.card.on("change",e=>{this.paymentMethod=e});const e=document.querySelector("#input_"+this.GFStripeObj.formId+"_"+this.GFStripeObj.activeFeed.link_email_field_id);null!==e&&(e.addEventListener("blur",this.handlelinkEmailFieldChange),window.addEventListener("load",async function(){const e=document.querySelector("#input_"+this.GFStripeObj.formId+"_"+this.GFStripeObj.activeFeed.link_email_field_id);String(e.value).toLowerCase().match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)&&this.GFStripeObj.isLastPage()&&this.handlelinkEmailFieldChange({target:{value:e.value}})}.bind(this)))}async reInitiateLinkWithEmailAddress(e){if(!1===this.GFStripeObj.isCreditCardOnPage())return;const t=e.target.value;void 0!==this.link&&null!==this.link&&"destroy"in this.link&&(this.link.destroy(),jQuery(".gfield #stripe-payment-link").remove()),this.link=await this.elements.create("linkAuthentication",{defaultValues:{email:t}}),this.mountLink(),t?jQuery(".gfield #stripe-payment-link").addClass("visible"):jQuery(".gfield #stripe-payment-link").removeClass("visible")}async validate(e){if(!this.paymentMethod.complete&&"link"!==this.paymentMethod.value.type)return this.failWithMessage(gforms_stripe_frontend_strings.payment_incomplete,this.GFStripeObj.formId),!1;gformAddSpinner(this.GFStripeObj.formId);const t=await n(this.getFormData(e.target));if("success"in t&&!1===t.success)return this.failWithMessage(gforms_stripe_frontend_strings.failed_to_confirm_intent,this.GFStripeObj.formId),!1;if(null===t.data.intent){const e=new URL(window.location.href);e.searchParams.append("resume_token",t.data.resume_token),window.location.href=e.href}setTimeout(()=>{},5e3),"data"in t&&"is_valid"in t.data&&t.data.is_valid&&"resume_token"in t.data&&"intent"in t.data&&"client_secret"in t.data.intent?(this.resetFormValidationErrors(),this.draftId=t.data.resume_token,"total"in t.data&&await this.updatePaymentAmount(t.data.total),setTimeout(async()=>{await this.confirm(t.data.resume_token,t.data.intent.client_secret)},1e3)):e.target.submit()}getFormData(e){const t=new FormData(e);t.delete("gform_submit");const r={action:"gfstripe_validate_form",feed_id:this.GFStripeObj.activeFeed.feedId,form_id:this.GFStripeObj.formId,payment_method:this.paymentMethod.value.type,nonce:gforms_stripe_frontend_strings.validate_form_nonce};return Object.keys(r).forEach(e=>{t.append(e,r[e])}),t}updatePaymentAmount(e){if(e<=0||"setup"===this.GFStripeObj.activeFeed.initial_payment_information.mode)return;let t=100*e;t=Math.round(100*t)/100,this.elements.update({amount:t})}async confirm(e,t,r){const i=new URL(window.location.href);i.searchParams.append("resume_token",e);const{error:n}=await this.elements.submit();if(n)return void this.failWithMessage(n.message,this.GFStripeObj.formId);const s={elements:this.elements,clientSecret:t,confirmParams:{return_url:i.toString(),payment_method_data:{billing_details:{address:{line1:GFMergeTag.replaceMergeTags(this.GFStripeObj.formId,this.getBillingAddressMergeTag(this.GFStripeObj.activeFeed.address_line1)),line2:GFMergeTag.replaceMergeTags(this.GFStripeObj.formId,this.getBillingAddressMergeTag(this.GFStripeObj.activeFeed.address_line2)),city:GFMergeTag.replaceMergeTags(this.GFStripeObj.formId,this.getBillingAddressMergeTag(this.GFStripeObj.activeFeed.address_city)),state:GFMergeTag.replaceMergeTags(this.GFStripeObj.formId,this.getBillingAddressMergeTag(this.GFStripeObj.activeFeed.address_state)),postal_code:GFMergeTag.replaceMergeTags(this.GFStripeObj.formId,this.getBillingAddressMergeTag(this.GFStripeObj.activeFeed.address_zip))}}}}};let a={};if(0===this.GFStripeObj.activeFeed.initial_payment_information.amount)try{a=await this.stripe.confirmSetup(s)}catch(e){console.log(e),this.failWithMessage(gforms_stripe_frontend_strings.failed_to_confirm_intent,this.GFStripeObj.formId)}else try{a=await this.stripe.confirmPayment(s)}catch(e){console.log(e),this.failWithMessage(gforms_stripe_frontend_strings.failed_to_confirm_intent,this.GFStripeObj.formId)}"paymentIntent"in a?this.handlePayment(a):await this.handleFailedPayment(a)}handlePayment(e){}async handleFailedPayment(e){this.failWithMessage(e.error.message,this.GFStripeObj.formId);let t=n(JSON.stringify({draft_id:this.draftId}),!0,"gfstripe_delete_draft_entry",gforms_stripe_frontend_strings.delete_draft_nonce);this.GFStripeObj.hasOwnProperty("cardErrorCount")&&(t=await n(JSON.stringify({increase_count:!0}),!0,"gfstripe_payment_element_check_rate_limiting",gforms_stripe_frontend_strings.rate_limiting_nonce),this.GFStripeObj.cardErrorCount=t.data.error_count)}destroy(){if(this.card&&this.card.destroy(),this.link){this.link.destroy();const e=document.querySelectorAll(".stripe-payment-link")[0];e&&e.remove()}}clearErrors(){this.GFStripeObj.GFCCField.next(".validation_message").length&&this.GFStripeObj.GFCCField.next(".validation_message").remove()}resetFormValidationErrors(){document.querySelectorAll(".gform_validation_errors, .validation_message").forEach(e=>{e.remove()}),document.querySelectorAll(".gfield_error").forEach(e=>{e.classList.remove("gfield_error")})}failWithMessage(e,t){e=e||gforms_stripe_frontend_strings.failed_to_process_payment,this.GFStripeObj.displayStripeCardError({error:{message:e}}),this.GFStripeObj.resetStripeStatus(jQuery("#gform_"+t),t,!0),jQuery("#gform_ajax_spinner_"+t).remove()}getBillingAddressMergeTag(e){return""===e?"":"{:"+e+":value}"}}window.GFStripe=null,gform.extensions=gform.extensions||{},gform.extensions.styles=gform.extensions.styles||{},gform.extensions.styles.gravityformsstripe=gform.extensions.styles.gravityformsstripe||{},i=jQuery,GFStripe=function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);this.form=null,this.activeFeed=null,this.GFCCField=null,this.stripeResponse=null,this.hasPaymentIntent=!1,this.stripePaymentHandler=null,this.cardStyle=this.cardStyle||{},gform.extensions.styles.gravityformsstripe[this.formId]=gform.extensions.styles.gravityformsstripe[this.formId]||{};const r=gform.extensions.styles.gravityformsstripe[this.formId][this.pageInstance]||{};this.setComponentStyleValue=function(e,t,r,i){let n="";if(0===t.indexOf("--")){const s=r.getPropertyValue(t);if(s)n=s;else{const t="fontSmoothing"===e?"-webkit-font-smoothing":e;n=(i?getComputedStyle(i):r).getPropertyValue(t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase())}}else n=t;return n.trim()},this.setComponentStyles=function(e,t,i){if(0===Object.keys(e).length)return;const n=document.getElementById("gform_"+this.formId),s=getComputedStyle(n),a=n.querySelector(".gfield input");Object.keys(e).forEach(n=>{if("object"!=typeof e[n]){if("object"!=typeof e[n]){let e="";i?t&&t!==i?(e=this.setComponentStyleValue(n,r[i][t][n],s,a),e&&(this.cardStyle[i][t][n]=e)):(e=this.setComponentStyleValue(n,r[i][n],s,a),e&&(this.cardStyle[i][n]=e)):(e=this.setComponentStyleValue(n,r[n],s,a),e&&(this.cardStyle[n]=e))}}else{i||(this.cardStyle[n]={}),i&&(this.cardStyle[i][n]={});const t=i||n;this.setComponentStyles(e[n],n,t)}})},this.init=async function(){if(this.setComponentStyles(r),this.isCreditCardOnPage()||"stripe.js"!==this.stripe_payment&&("elements"!==this.stripe_payment||i("#gf_stripe_response").length)){var e=this,t=null,n=!1,s=!1,o=this.apiKey;switch(this.form=i("#gform_"+this.formId),this.GFCCField=i("#input_"+this.formId+"_"+this.ccFieldId+"_1"),gform.addAction("gform_frontend_feeds_evaluated",(async function(r,c){if(c===e.formId){t=null,n=!1,s=!1;for(var f=0;f<Object.keys(r).length;f++)if("gravityformsstripe"===r[f].addonSlug&&r[f].isActivated){n=!0;for(var u=0;u<Object.keys(e.feeds).length;u++)if(e.feeds[u].feedId===r[f].feedId){t=e.feeds[u];break}if(o=t.hasOwnProperty("apiKey")?t.apiKey:e.apiKey,e.activeFeed=t,gform.addFilter("gform_product_total",(function(t,r){if("form_total"!==e.activeFeed.paymentAmount){var i=GFMergeTag.getMergeTagValue(r,e.activeFeed.paymentAmount,":price"),n=GFMergeTag.getMergeTagValue(r,e.activeFeed.paymentAmount,":qty");"string"==typeof i&&(i=GFMergeTag.getMergeTagValue(r,e.activeFeed.paymentAmount+".2",":price"),n=GFMergeTag.getMergeTagValue(r,e.activeFeed.paymentAmount+".3",":qty")),window["gform_stripe_amount_"+r]=i*n}else"form_total"===e.activeFeed.paymentAmount&&(window["gform_stripe_amount_"+r]=t);return"payment_element"==e.stripe_payment&&null!==e.stripePaymentHandler&&null!==e.stripePaymentHandler.elements&&"1"===gforms_stripe_frontend_strings.stripe_connect_enabled&&e.stripePaymentHandler.updatePaymentAmount(window["gform_stripe_amount_"+r]),window["gform_stripe_amount_"+r]}),51),gformCalculateTotalPrice(c),"payment_element"==e.stripe_payment)e.stripePaymentHandler=new a(o,e);else if("elements"===e.stripe_payment)d=Stripe(o),l=d.elements(),s=""!==t.address_zip,null!=p&&p.hasOwnProperty("_destroyed")&&!1===p._destroyed&&p.destroy(),e.GFCCField.next(".validation_message").length&&e.GFCCField.next(".validation_message").remove(),p=l.create("card",{classes:e.cardClasses,style:e.cardStyle,hidePostalCode:s}),i(".gform_stripe_requires_action").length?(2===i(".ginput_container_creditcard > div").length?(i(".ginput_container_creditcard > div:last").hide(),i(".ginput_container_creditcard > div:first").html("<p><strong>"+gforms_stripe_frontend_strings.requires_action+"</strong></p>")):i(".ginput_container_creditcard").html("<p><strong>"+gforms_stripe_frontend_strings.requires_action+"</strong></p>"),e.scaActionHandler(d,c)):(p.mount("#"+e.GFCCField.attr("id")),p.on("change",(function(t){e.displayStripeCardError(t)})));else if("stripe.js"==e.stripe_payment){Stripe.setPublishableKey(o);break}break}n||("elements"!==e.stripe_payment&&"payment_element"!==e.stripe_payment||(null!=l&&p===l.getElement("card")&&p.destroy(),null!==e.stripePaymentHandler&&e.stripePaymentHandler.destroy(),e.GFCCField.next(".validation_message").length||e.GFCCField.after('<div class="gfield_description validation_message gfield_validation_message">'+gforms_stripe_frontend_strings.no_active_frontend_feed+"</div>"),wp.a11y.speak(gforms_stripe_frontend_strings.no_active_frontend_feed)),e.resetStripeStatus(e.form,c,e.isLastPage()),o=e.apiKey,e.activeFeed=null)}})),this.stripe_payment){case"elements":var d=null,l=null,p=null;i("#gf_stripe_response").length&&(this.stripeResponse=JSON.parse(i("#gf_stripe_response").val()),this.stripeResponse.hasOwnProperty("client_secret")&&(this.hasPaymentIntent=!0))}if(i("#gform_"+this.formId).on("submit",(function(r){e.updatePaymentAmount();let s=!1;const a=parseInt(i("#gform_source_page_number_"+e.formId).val(),10),o=parseInt(i("#gform_target_page_number_"+e.formId).val(),10);if(a>o&&0!==o&&(s=!0),!(s||!n||i(this).data("gfstripesubmitting")||1==i("#gform_save_"+e.formId).val()||!e.isLastPage()&&"elements"!==e.stripe_payment||gformIsHidden(e.GFCCField)||e.maybeHitRateLimits()||e.invisibleCaptchaPending()||"payment_element"===e.stripe_payment&&0===window["gform_stripe_amount_"+formId]))switch(r.preventDefault(),i(this).data("gfstripesubmitting",!0),e.maybeAddSpinner(),e.stripe_payment){case"payment_element":e.injectHoneypot(r),e.stripePaymentHandler.validate(r);break;case"elements":if(e.form=i(this),e.isLastPage()&&!e.isCreditCardOnPage()||gformIsHidden(e.GFCCField)||s)return void i(this).submit();"product"===t.type?e.createPaymentMethod(d,p):e.createToken(d,p);break;case"stripe.js":var l=i(this),c="input_"+e.formId+"_"+e.ccFieldId+"_",f={number:l.find("#"+c+"1").val(),exp_month:l.find("#"+c+"2_month").val(),exp_year:l.find("#"+c+"2_year").val(),cvc:l.find("#"+c+"3").val(),name:l.find("#"+c+"5").val()};e.form=l,Stripe.card.createToken(f,(function(t,r){e.responseHandler(t,r)}))}})),"payment_element_intent_failure"in e&&e.payment_element_intent_failure){const t=jQuery('<div class="gform_validation_errors" id="gform_'+e.formId+'_validation_container" data-js="gform-focus-validation-error" tabindex="-1"><h2 class="gform_submission_error hide_summary"><span class="gform-icon gform-icon--close"></span>'+gforms_stripe_frontend_strings.payment_element_intent_failure+"</h2></div>");jQuery("#gform_wrapper_"+e.formId).prepend(t)}}},this.getBillingAddressMergeTag=function(e){return""===e?"":"{:"+e+":value}"},this.responseHandler=function(e,t){for(var r=this.form,n="input_"+this.formId+"_"+this.ccFieldId+"_",s=["1","2_month","2_year","3","5"],a=0;a<s.length;a++){var o=r.find("#"+n+s[a]);if("1"==s[a]){var d=i.trim(o.val()),l=gformFindCardType(d);void 0!==this.cardLabels[l]&&(l=this.cardLabels[l]),r.append(i('<input type="hidden" name="stripe_credit_card_last_four" />').val(d.slice(-4))),r.append(i('<input type="hidden" name="stripe_credit_card_type" />').val(l))}}r.append(i('<input type="hidden" name="stripe_response" />').val(i.toJSON(t))),r.submit()},this.elementsResponseHandler=function(e){var t=this.form,r=this,n=this.activeFeed,s=gform.applyFilters("gform_stripe_currency",this.currency,this.formId),a=0===gf_global.gf_currency_config.decimals?window["gform_stripe_amount_"+this.formId]:gformRoundPrice(100*window["gform_stripe_amount_"+this.formId]);if(e.error)return this.displayStripeCardError(e),void this.resetStripeStatus(t,this.formId,this.isLastPage());if(this.hasPaymentIntent)if("product"===n.type)e.hasOwnProperty("paymentMethod")?(i("#gf_stripe_credit_card_last_four").val(e.paymentMethod.card.last4),i("#stripe_credit_card_type").val(e.paymentMethod.card.brand),i.ajax({async:!1,url:gforms_stripe_frontend_strings.ajaxurl,dataType:"json",method:"POST",data:{action:"gfstripe_update_payment_intent",nonce:gforms_stripe_frontend_strings.create_payment_intent_nonce,payment_intent:e.id,payment_method:e.paymentMethod,currency:s,amount:a,feed_id:n.feedId},success:function(e){e.success?(i("#gf_stripe_response").val(i.toJSON(e.data)),t.submit()):(e.error=e.data,delete e.data,r.displayStripeCardError(e),r.resetStripeStatus(t,r.formId,r.isLastPage()))}})):e.hasOwnProperty("amount")&&t.submit();else{var o=JSON.parse(i("#gf_stripe_response").val());o.updatedToken=e.token.id,i("#gf_stripe_response").val(i.toJSON(o)),t.append(i('<input type="hidden" name="stripe_credit_card_last_four" id="gf_stripe_credit_card_last_four" />').val(e.token.card.last4)),t.append(i('<input type="hidden" name="stripe_credit_card_type" id="stripe_credit_card_type" />').val(e.token.card.brand)),t.submit()}else i("#gf_stripe_response").length?i("#gf_stripe_response").val(i.toJSON(e)):t.append(i('<input type="hidden" name="stripe_response" id="gf_stripe_response" />').val(i.toJSON(e))),"product"===n.type?(t.append(i('<input type="hidden" name="stripe_credit_card_last_four" id="gf_stripe_credit_card_last_four" />').val(e.paymentMethod.card.last4)),t.append(i('<input type="hidden" name="stripe_credit_card_type" id="stripe_credit_card_type" />').val(e.paymentMethod.card.brand)),i.ajax({async:!1,url:gforms_stripe_frontend_strings.ajaxurl,dataType:"json",method:"POST",data:{action:"gfstripe_create_payment_intent",nonce:gforms_stripe_frontend_strings.create_payment_intent_nonce,payment_method:e.paymentMethod,currency:s,amount:a,feed_id:n.feedId},success:function(e){e.success?(i("#gf_stripe_response").length?i("#gf_stripe_response").val(i.toJSON(e.data)):t.append(i('<input type="hidden" name="stripe_response" id="gf_stripe_response" />').val(i.toJSON(e.data))),t.submit()):(e.error=e.data,delete e.data,r.displayStripeCardError(e),r.resetStripeStatus(t,r.formId,r.isLastPage()))}})):(t.append(i('<input type="hidden" name="stripe_credit_card_last_four" id="gf_stripe_credit_card_last_four" />').val(e.token.card.last4)),t.append(i('<input type="hidden" name="stripe_credit_card_type" id="stripe_credit_card_type" />').val(e.token.card.brand)),t.submit())},this.scaActionHandler=function(e,t){if(!i("#gform_"+t).data("gfstripescaauth")){i("#gform_"+t).data("gfstripescaauth",!0);var r=this,n=JSON.parse(i("#gf_stripe_response").val());"product"===this.activeFeed.type?e.retrievePaymentIntent(n.client_secret).then((function(s){"requires_action"===s.paymentIntent.status&&e.handleCardAction(n.client_secret).then((function(e){var n=JSON.parse(i("#gf_stripe_response").val());n.scaSuccess=!0,i("#gf_stripe_response").val(i.toJSON(n)),r.maybeAddSpinner(),i("#gform_"+t).data("gfstripescaauth",!1),i("#gform_"+t).data("gfstripesubmitting",!0).submit()}))})):e.retrievePaymentIntent(n.client_secret).then((function(s){"requires_action"===s.paymentIntent.status&&e.handleCardPayment(n.client_secret).then((function(e){r.maybeAddSpinner(),i("#gform_"+t).data("gfstripescaauth",!1),i("#gform_"+t).data("gfstripesubmitting",!0).submit()}))}))}},this.isLastPage=function(){var e=i("#gform_target_page_number_"+this.formId);return!(e.length>0)||0==e.val()},this.isCreditCardOnPage=function(){var e=this.getCurrentPageNumber();return!this.ccPage||!e||this.ccPage==e},this.getCurrentPageNumber=function(){var e=i("#gform_source_page_number_"+this.formId);return e.length>0&&e.val()},this.maybeAddSpinner=function(){if(!this.isAjax)if("function"==typeof gformAddSpinner)gformAddSpinner(this.formId);else{var e=this.formId;if(0==jQuery("#gform_ajax_spinner_"+e).length){var t=gform.applyFilters("gform_spinner_url",gf_global.spinnerUrl,e);gform.applyFilters("gform_spinner_target_elem",jQuery("#gform_submit_button_"+e+", #gform_wrapper_"+e+" .gform_next_button, #gform_send_resume_link_button_"+e),e).after('<img id="gform_ajax_spinner_'+e+'"  class="gform_ajax_spinner" src="'+t+'" alt="" />')}}},this.resetStripeStatus=function(e,t,r){i("#gf_stripe_response, #gf_stripe_credit_card_last_four, #stripe_credit_card_type").remove(),e.data("gfstripesubmitting",!1),i("#gform_ajax_spinner_"+t).remove(),r&&(window["gf_submitting_"+t]=!1)},this.displayStripeCardError=function(e){e.error&&!this.GFCCField.next(".validation_message").length&&this.GFCCField.after('<div class="gfield_description validation_message gfield_validation_message"></div>');var t=this.GFCCField.next(".validation_message");e.error?(t.html(e.error.message),wp.a11y.speak(e.error.message,"assertive"),i("#gform_ajax_spinner_"+this.formId).length>0&&i("#gform_ajax_spinner_"+this.formId).remove()):t.remove()},this.updatePaymentAmount=function(){var e=this.formId,t=this.activeFeed;if(null!==t){if("form_total"!==t.paymentAmount){var r=GFMergeTag.getMergeTagValue(e,t.paymentAmount,":price"),i=GFMergeTag.getMergeTagValue(e,t.paymentAmount,":qty");"string"==typeof r&&(r=GFMergeTag.getMergeTagValue(e,t.paymentAmount+".2",":price"),i=GFMergeTag.getMergeTagValue(e,t.paymentAmount+".3",":qty")),window["gform_stripe_amount_"+e]=r*i}t.hasOwnProperty("setupFee")&&(r=GFMergeTag.getMergeTagValue(e,t.setupFee,":price"),i=GFMergeTag.getMergeTagValue(e,t.setupFee,":qty"),"string"==typeof r&&(r=GFMergeTag.getMergeTagValue(e,t.setupFee+".2",":price"),i=GFMergeTag.getMergeTagValue(e,t.setupFee+".3",":qty")),window["gform_stripe_amount_"+e]+=r*i)}else window["gform_stripe_amount_"+e]=0},this.createToken=function(e,t){console.log(this);const r=this,n=this.activeFeed,s={name:i("#input_"+r.formId+"_"+r.ccFieldId+"_5").val(),address_line1:GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(n.address_line1)),address_line2:GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(n.address_line2)),address_city:GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(n.address_city)),address_state:GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(n.address_state)),address_zip:GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(n.address_zip)),address_country:GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(n.address_country)),currency:gform.applyFilters("gform_stripe_currency",this.currency,this.formId)};e.createToken(t,s).then((function(e){r.elementsResponseHandler(e)}))},this.createPaymentMethod=function(e,t,r){var n=this,s=this.activeFeed,a="";if(""!==s.address_country&&(a=GFMergeTag.replaceMergeTags(n.formId,n.getBillingAddressMergeTag(s.address_country))),""===a||void 0!==r&&""!==r){var o=i("#input_"+this.formId+"_"+this.ccFieldId+"_5").val(),d=GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(s.address_line1)),l=GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(s.address_line2)),p=GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(s.address_city)),c=GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(s.address_state)),f=GFMergeTag.replaceMergeTags(this.formId,this.getBillingAddressMergeTag(s.address_zip)),u={billing_details:{name:null,address:{}}};""!==o&&(u.billing_details.name=o),""!==d&&(u.billing_details.address.line1=d),""!==l&&(u.billing_details.address.line2=l),""!==p&&(u.billing_details.address.city=p),""!==c&&(u.billing_details.address.state=c),""!==f&&(u.billing_details.address.postal_code=f),""!==r&&(u.billing_details.address.country=r),null===u.billing_details.name&&delete u.billing_details.name,u.billing_details.address==={}&&delete u.billing_details.address,e.createPaymentMethod("card",t,u).then((function(e){null!==n.stripeResponse&&(e.id=n.stripeResponse.id,e.client_secret=n.stripeResponse.client_secret),n.elementsResponseHandler(e)}))}else i.ajax({async:!1,url:gforms_stripe_frontend_strings.ajaxurl,dataType:"json",method:"POST",data:{action:"gfstripe_get_country_code",nonce:gforms_stripe_frontend_strings.create_payment_intent_nonce,country:a,feed_id:s.feedId},success:function(r){r.success&&n.createPaymentMethod(e,t,r.data.code)}})},this.maybeHitRateLimits=function(){return!!(this.hasOwnProperty("cardErrorCount")&&this.cardErrorCount>=5)},this.invisibleCaptchaPending=function(){var e=this.form.find(".ginput_recaptcha");if(!e.length||"invisible"!==e.data("size"))return!1;var t=e.find(".g-recaptcha-response");return!(t.length&&t.val())},this.injectHoneypot=e=>{const t=e.target;if((this.isFormSubmission(t)||this.isSaveContinue(t))&&!this.isHeadlessBrowser()){const e=`<input type="hidden" name="version_hash" value="${gf_global.version_hash}" />`;t.insertAdjacentHTML("beforeend",e)}},this.isSaveContinue=e=>{const t=e.dataset.formid,r=this.getNodes("#gform_save_"+t,!0,e,!0);return r.length>0&&"1"===r[0].value},this.isFormSubmission=e=>{const t=e.dataset.formid,r=this.getNodes(`input[name = "gform_target_page_number_${t}"]`,!0,e,!0)[0];return void 0!==r&&0===parseInt(r.value)},this.isHeadlessBrowser=()=>window._phantom||window.callPhantom||window.__phantomas||window.Buffer||window.emit||window.spawn||window.webdriver||window._selenium||window._Selenium_IDE_Recorder||window.callSelenium||window.__nightmare||window.domAutomation||window.domAutomationController||window.document.__webdriver_evaluate||window.document.__selenium_evaluate||window.document.__webdriver_script_function||window.document.__webdriver_script_func||window.document.__webdriver_script_fn||window.document.__fxdriver_evaluate||window.document.__driver_unwrapped||window.document.__webdriver_unwrapped||window.document.__driver_evaluate||window.document.__selenium_unwrapped||window.document.__fxdriver_unwrapped||window.document.documentElement.getAttribute("selenium")||window.document.documentElement.getAttribute("webdriver")||window.document.documentElement.getAttribute("driver"),this.getNodes=(e="",t=!1,r=document,i=!1)=>{const n=i?e:`[data-js="${e}"]`;let s=r.querySelectorAll(n);return t&&(s=this.convertElements(s)),s},this.convertElements=(e=[])=>{const t=[];let r=e.length;for(;r--;t.unshift(e[r]));return t},this.init()}}]);